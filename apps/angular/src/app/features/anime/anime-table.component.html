<mat-toolbar color="primary">
  <mat-toolbar-row>
    <span id="page-heading">Anime Catalog</span>
  </mat-toolbar-row>
</mat-toolbar>

<div class="mat-elevation-z8 default-layout" *ngIf="animeData$ | async as anime; else loading">
  <form>
    <div>
      <mat-form-field appearance="fill">
        <mat-label>Anime types</mat-label>
        <mat-select [value]="selectedAnimeTypes" (closed)="confirmChanges()" (selectionChange)="changeAnimeTypes($event)" multiple>
          <mat-option *ngFor="let type of availableAnimeTypes"
            [value]="type">
            {{type}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="fill">
        <mat-label>Search anime</mat-label>
        <input matInput placeholder="Ex. JoJo" [value]="animeTitle" (input)="changeSearchingTitle($event)"/>
        <button type="button" mat-icon-button color="primary" (click)="confirmChanges()">
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
    </div>
  </form>

  <mat-paginator
    (page)="changePage($event)"
    [length]="anime.count"
    [pageSize]="10"
    [pageIndex]="currentPage"
    showFirstLastButtons
    hidePageSize>
  </mat-paginator>

  <table
    matSort
    (matSortChange)="changeSortingTarget($event)"
    [matSortDirection]="sorting.direction"
    [matSortActive]="sorting.active"
    mat-table
    [dataSource]="anime.results"
    class="anime-table"
    aria-label="anime"
    aria-describedby="page-heading">
    <ng-container matColumnDef="image">
      <th mat-header-cell *matHeaderCellDef class="anime-table__heading-cell">Image</th>
      <td mat-cell *matCellDef="let anime" class="anime-table__cell">
        <img [src]="anime.image" [alt]="anime.titleEnglish" class="anime-table__image">
      </td>
    </ng-container>
    <ng-container matColumnDef="title">
      <th mat-sort-header="title_eng" mat-header-cell *matHeaderCellDef>Title</th>
      <td mat-cell *matCellDef="let anime">
        {{anime.titleEnglish || '-'}} ({{anime.titleJapanese || '-'}})
      </td>
    </ng-container>
    <ng-container matColumnDef="aired start">
      <th mat-sort-header="aired__startswith" mat-header-cell *matHeaderCellDef>Aired start</th>
      <td mat-cell *matCellDef="let anime">
        {{anime.aired.start | date:"YYYY"}}
      </td>
    </ng-container>
    <ng-container matColumnDef="status">
      <th mat-sort-header="status" mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let anime">
        {{anime.status | animeStatus}}
      </td>
    </ng-container>
    <ng-container matColumnDef="type">
      <th mat-header-cell *matHeaderCellDef>Type</th>
      <td mat-cell *matCellDef="let anime">
        {{anime.type | animeType}}
      </td>
    </ng-container>
    <tr id="anime-table__heading-row" mat-header-row *matHeaderRowDef="tableColumns" class="anime-table__row"></tr>
    <tr mat-row *matRowDef="let row; columns: tableColumns" class="anime-table__row"></tr>
  </table>
</div>

<ng-template #loading>
  <div class="loading-layout">
    <mat-spinner
      color="primary"
      [diameter]="120">
    </mat-spinner>
  </div>
</ng-template>
